{"ast":null,"code":"import { observable, tap } from '@trpc/server/observable';\n\n/// <reference lib=\"dom.iterable\" />\nfunction isFormData(value) {\n  if (typeof FormData === 'undefined') {\n    // FormData is not supported\n    return false;\n  }\n  return value instanceof FormData;\n}\nconst palettes = {\n  css: {\n    query: ['72e3ff', '3fb0d8'],\n    mutation: ['c5a3fc', '904dfc'],\n    subscription: ['ff49e1', 'd83fbe']\n  },\n  ansi: {\n    regular: {\n      // Cyan background, black and white text respectively\n      query: ['\\x1b[30;46m', '\\x1b[97;46m'],\n      // Magenta background, black and white text respectively\n      mutation: ['\\x1b[30;45m', '\\x1b[97;45m'],\n      // Green background, black and white text respectively\n      subscription: ['\\x1b[30;42m', '\\x1b[97;42m']\n    },\n    bold: {\n      query: ['\\x1b[1;30;46m', '\\x1b[1;97;46m'],\n      mutation: ['\\x1b[1;30;45m', '\\x1b[1;97;45m'],\n      subscription: ['\\x1b[1;30;42m', '\\x1b[1;97;42m']\n    }\n  }\n};\nfunction constructPartsAndArgs(opts) {\n  const {\n    direction,\n    type,\n    path,\n    id,\n    input\n  } = opts;\n  const parts = [];\n  const args = [];\n  if (opts.colorMode === 'ansi') {\n    const [lightRegular, darkRegular] = palettes.ansi.regular[type];\n    const [lightBold, darkBold] = palettes.ansi.bold[type];\n    const reset = '\\x1b[0m';\n    parts.push(direction === 'up' ? lightRegular : darkRegular, direction === 'up' ? '>>' : '<<', type, direction === 'up' ? lightBold : darkBold, `#${id}`, path, reset);\n    if (direction === 'up') {\n      args.push({\n        input: opts.input\n      });\n    } else {\n      args.push({\n        input: opts.input,\n        // strip context from result cause it's too noisy in terminal wihtout collapse mode\n        result: 'result' in opts.result ? opts.result.result : opts.result,\n        elapsedMs: opts.elapsedMs\n      });\n    }\n    return {\n      parts,\n      args\n    };\n  }\n  const [light, dark] = palettes.css[type];\n  const css = `\n    background-color: #${direction === 'up' ? light : dark}; \n    color: ${direction === 'up' ? 'black' : 'white'};\n    padding: 2px;\n  `;\n  parts.push('%c', direction === 'up' ? '>>' : '<<', type, `#${id}`, `%c${path}%c`, '%O');\n  args.push(css, `${css}; font-weight: bold;`, `${css}; font-weight: normal;`);\n  if (direction === 'up') {\n    args.push({\n      input,\n      context: opts.context\n    });\n  } else {\n    args.push({\n      input,\n      result: opts.result,\n      elapsedMs: opts.elapsedMs,\n      context: opts.context\n    });\n  }\n  return {\n    parts,\n    args\n  };\n}\n// maybe this should be moved to it's own package\nconst defaultLogger = ({\n  c = console,\n  colorMode = 'css'\n}) => props => {\n  const rawInput = props.input;\n  const input = isFormData(rawInput) ? Object.fromEntries(rawInput) : rawInput;\n  const {\n    parts,\n    args\n  } = constructPartsAndArgs({\n    ...props,\n    colorMode,\n    input\n  });\n  const fn = props.direction === 'down' && props.result && (props.result instanceof Error || 'error' in props.result.result) ? 'error' : 'log';\n  c[fn].apply(null, [parts.join(' ')].concat(args));\n};\n/**\n * @see https://trpc.io/docs/client/links/loggerLink\n */\nfunction loggerLink(opts = {}) {\n  const {\n    enabled = () => true\n  } = opts;\n  const colorMode = opts.colorMode ?? (typeof window === 'undefined' ? 'ansi' : 'css');\n  const {\n    logger = defaultLogger({\n      c: opts.console,\n      colorMode\n    })\n  } = opts;\n  return () => {\n    return ({\n      op,\n      next\n    }) => {\n      return observable(observer => {\n        // ->\n        enabled({\n          ...op,\n          direction: 'up'\n        }) && logger({\n          ...op,\n          direction: 'up'\n        });\n        const requestStartTime = Date.now();\n        function logResult(result) {\n          const elapsedMs = Date.now() - requestStartTime;\n          enabled({\n            ...op,\n            direction: 'down',\n            result\n          }) && logger({\n            ...op,\n            direction: 'down',\n            elapsedMs,\n            result\n          });\n        }\n        return next(op).pipe(tap({\n          next(result) {\n            logResult(result);\n          },\n          error(result) {\n            logResult(result);\n          }\n        })).subscribe(observer);\n      });\n    };\n  };\n}\nexport { loggerLink };","map":{"version":3,"names":["observable","tap","isFormData","value","FormData","palettes","css","query","mutation","subscription","ansi","regular","bold","constructPartsAndArgs","opts","direction","type","path","id","input","parts","args","colorMode","lightRegular","darkRegular","lightBold","darkBold","reset","push","result","elapsedMs","light","dark","context","defaultLogger","c","console","props","rawInput","Object","fromEntries","fn","Error","apply","join","concat","loggerLink","enabled","window","logger","op","next","observer","requestStartTime","Date","now","logResult","pipe","error","subscribe"],"sources":["/Users/danilakiva/jspool/s21_arcade_games/node_modules/@trpc/client/dist/links/loggerLink.mjs"],"sourcesContent":["import { observable, tap } from '@trpc/server/observable';\n\n/// <reference lib=\"dom.iterable\" />\nfunction isFormData(value) {\n    if (typeof FormData === 'undefined') {\n        // FormData is not supported\n        return false;\n    }\n    return value instanceof FormData;\n}\nconst palettes = {\n    css: {\n        query: [\n            '72e3ff',\n            '3fb0d8'\n        ],\n        mutation: [\n            'c5a3fc',\n            '904dfc'\n        ],\n        subscription: [\n            'ff49e1',\n            'd83fbe'\n        ]\n    },\n    ansi: {\n        regular: {\n            // Cyan background, black and white text respectively\n            query: [\n                '\\x1b[30;46m',\n                '\\x1b[97;46m'\n            ],\n            // Magenta background, black and white text respectively\n            mutation: [\n                '\\x1b[30;45m',\n                '\\x1b[97;45m'\n            ],\n            // Green background, black and white text respectively\n            subscription: [\n                '\\x1b[30;42m',\n                '\\x1b[97;42m'\n            ]\n        },\n        bold: {\n            query: [\n                '\\x1b[1;30;46m',\n                '\\x1b[1;97;46m'\n            ],\n            mutation: [\n                '\\x1b[1;30;45m',\n                '\\x1b[1;97;45m'\n            ],\n            subscription: [\n                '\\x1b[1;30;42m',\n                '\\x1b[1;97;42m'\n            ]\n        }\n    }\n};\nfunction constructPartsAndArgs(opts) {\n    const { direction , type , path , id , input  } = opts;\n    const parts = [];\n    const args = [];\n    if (opts.colorMode === 'ansi') {\n        const [lightRegular, darkRegular] = palettes.ansi.regular[type];\n        const [lightBold, darkBold] = palettes.ansi.bold[type];\n        const reset = '\\x1b[0m';\n        parts.push(direction === 'up' ? lightRegular : darkRegular, direction === 'up' ? '>>' : '<<', type, direction === 'up' ? lightBold : darkBold, `#${id}`, path, reset);\n        if (direction === 'up') {\n            args.push({\n                input: opts.input\n            });\n        } else {\n            args.push({\n                input: opts.input,\n                // strip context from result cause it's too noisy in terminal wihtout collapse mode\n                result: 'result' in opts.result ? opts.result.result : opts.result,\n                elapsedMs: opts.elapsedMs\n            });\n        }\n        return {\n            parts,\n            args\n        };\n    }\n    const [light, dark] = palettes.css[type];\n    const css = `\n    background-color: #${direction === 'up' ? light : dark}; \n    color: ${direction === 'up' ? 'black' : 'white'};\n    padding: 2px;\n  `;\n    parts.push('%c', direction === 'up' ? '>>' : '<<', type, `#${id}`, `%c${path}%c`, '%O');\n    args.push(css, `${css}; font-weight: bold;`, `${css}; font-weight: normal;`);\n    if (direction === 'up') {\n        args.push({\n            input,\n            context: opts.context\n        });\n    } else {\n        args.push({\n            input,\n            result: opts.result,\n            elapsedMs: opts.elapsedMs,\n            context: opts.context\n        });\n    }\n    return {\n        parts,\n        args\n    };\n}\n// maybe this should be moved to it's own package\nconst defaultLogger = ({ c =console , colorMode ='css'  })=>(props)=>{\n        const rawInput = props.input;\n        const input = isFormData(rawInput) ? Object.fromEntries(rawInput) : rawInput;\n        const { parts , args  } = constructPartsAndArgs({\n            ...props,\n            colorMode,\n            input\n        });\n        const fn = props.direction === 'down' && props.result && (props.result instanceof Error || 'error' in props.result.result) ? 'error' : 'log';\n        c[fn].apply(null, [\n            parts.join(' ')\n        ].concat(args));\n    };\n/**\n * @see https://trpc.io/docs/client/links/loggerLink\n */ function loggerLink(opts = {}) {\n    const { enabled =()=>true  } = opts;\n    const colorMode = opts.colorMode ?? (typeof window === 'undefined' ? 'ansi' : 'css');\n    const { logger =defaultLogger({\n        c: opts.console,\n        colorMode\n    })  } = opts;\n    return ()=>{\n        return ({ op , next  })=>{\n            return observable((observer)=>{\n                // ->\n                enabled({\n                    ...op,\n                    direction: 'up'\n                }) && logger({\n                    ...op,\n                    direction: 'up'\n                });\n                const requestStartTime = Date.now();\n                function logResult(result) {\n                    const elapsedMs = Date.now() - requestStartTime;\n                    enabled({\n                        ...op,\n                        direction: 'down',\n                        result\n                    }) && logger({\n                        ...op,\n                        direction: 'down',\n                        elapsedMs,\n                        result\n                    });\n                }\n                return next(op).pipe(tap({\n                    next (result) {\n                        logResult(result);\n                    },\n                    error (result) {\n                        logResult(result);\n                    }\n                })).subscribe(observer);\n            });\n        };\n    };\n}\n\nexport { loggerLink };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}